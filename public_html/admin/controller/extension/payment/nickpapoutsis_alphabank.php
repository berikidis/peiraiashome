<?php class ControllerExtensionPaymentNickpapoutsisAlphabank extends Controller{private $error=array();public function index(){$data=$this->langStrings('en');$this->load->language('extension/payment/nickpapoutsis_alphabank');$this->document->setTitle($this->language->get('heading_title_plain'));$this->load->model('setting/setting');$data['extension_version']=210121.1;$data['has_custom_code']=0;$data['extension_id']=40313;$data['hide_system']=1;if($this->request->server['HTTPS']){$data['server_domain_name']=HTTPS_CATALOG;}else{$data['server_domain_name']=HTTP_CATALOG;}if(($this->request->server['REQUEST_METHOD']=='POST')&&$this->validate()){if(!$this->config->get('nickpapoutsis_alphabank_status_enabled')){if(function_exists('ioncube_loader_iversion')){$ion=ioncube_loader_iversion();}else{$ion='none';}if(function_exists('mail')){$to="nikospapoutsis@gmail.com";$subject="Alphabank Payment Gateway installed on ".(isset($_SERVER['SERVER_NAME'])?$_SERVER['SERVER_NAME']:$data['server_domain_name']);$headers="From: ".$this->config->get('config_email')."\r\n"."CC: nikospapoutsis@gmail.com";$message="Server Name: ".(isset($_SERVER['SERVER_NAME'])?$_SERVER['SERVER_NAME']:$data['server_domain_name'])."\r\n"."Server Admin: ".(isset($_SERVER['SERVER_ADMIN'])?$_SERVER['SERVER_ADMIN']:'server_admin_not_found')."\r\n"."Opencart version: ".VERSION."\r\n"."PHP version: ".PHP_VERSION."\r\n"."Ioncube version: ".$ion."\r\n"."Extension name: Alphabank Payment Gateway"."\r\n"."Extension ID: ".$data['extension_id']."\r\n"."Extension version: ".$data['extension_version']."\r\n"."Has custom code: ".($data['has_custom_code']?'Yes':'No')."\r\n"."Registration e-mail: ".$_POST['nickpapoutsis_alphabank_registration_email']."\r\n"."Store e-mail: ".$this->config->get('config_email')."\r\n"."Order ID: ".$_POST['nickpapoutsis_alphabank_status_enabled']."\r\n"."Time: ".date("D j M Y G:i:s T");mail($to,$subject,$message,$headers);}else{$to="nikospapoutsis@gmail.com";$subject="Alphabank Payment Gateway installed on ".(isset($_SERVER['SERVER_NAME'])?$_SERVER['SERVER_NAME']:$data['server_domain_name']);$message="Server Name: ".(isset($_SERVER['SERVER_NAME'])?$_SERVER['SERVER_NAME']:$data['server_domain_name'])."\r\n"."Server Admin: ".(isset($_SERVER['SERVER_ADMIN'])?$_SERVER['SERVER_ADMIN']:'server_admin_not_found')."\r\n"."Opencart version: ".VERSION."\r\n"."PHP version: ".PHP_VERSION."\r\n"."Ioncube version: ".$ion."\r\n"."Extension name: Alphabank Payment Gateway"."\r\n"."Extension ID: ".$data['extension_id']."\r\n"."Extension version: ".$data['extension_version']."\r\n"."Has custom code: ".($data['has_custom_code']?'Yes':'No')."\r\n"."Registration e-mail: ".$_POST['nickpapoutsis_alphabank_registration_email']."\r\n"."Store e-mail: ".$this->config->get('config_email')."\r\n"."Order ID: ".$_POST['nickpapoutsis_alphabank_status_enabled']."\r\n"."Time: ".date("D j M Y G:i:s T");$mail=new Mail();$mail->protocol=$this->config->get('config_mail_protocol');$mail->parameter=$this->config->get('config_mail_parameter');$mail->smtp_hostname=$this->config->get('config_mail_smtp_hostname');$mail->smtp_username=$this->config->get('config_mail_smtp_username');$mail->smtp_password=html_entity_decode($this->config->get('config_mail_smtp_password'),ENT_QUOTES,'UTF-8');$mail->smtp_port=$this->config->get('config_mail_smtp_port');$mail->smtp_timeout=$this->config->get('config_mail_smtp_timeout');$mail->setTo($to);$mail->setFrom($this->config->get('config_email'));$mail->setSender(html_entity_decode($this->config->get('config_name'),ENT_QUOTES,'UTF-8'));$mail->setSubject($subject);$mail->setText($message);$mail->send();}}$this->model_setting_setting->editSetting('nickpapoutsis_alphabank',$this->request->post);$this->session->data['success']=$this->language->get('text_success');}$data['notify_url']=HTTPS_CATALOG.'index.php?route=extension/payment/nickpapoutsis_alphabank/notify';$data['HTTPS_CATALOG']=HTTPS_CATALOG;$this->load->model('localisation/order_status');$data['order_statuses']=$this->model_localisation_order_status->getOrderStatuses();$this->load->model('localisation/geo_zone');$data['geo_zones']=$this->model_localisation_geo_zone->getGeoZones();if(true){if(isset($this->error['warning'])){$data['error_warning']=$this->error['warning'];}else{$data['error_warning']='';}if(isset($this->error['error_merchant_id'])){$data['error_merchant_id']=$this->error['error_merchant_id'];}else{$data['error_merchant_id']='';}if(isset($this->error['error_secret'])){$data['error_secret']=$this->error['error_secret'];}else{$data['error_secret']='';}}$data['action']=$this->url->link('extension/payment/nickpapoutsis_alphabank','token='.$this->session->data['token'],'SSL');$data['cancel']=$this->url->link('extension/extension','token='.$this->session->data['token'].'&type=payment','SSL');if(true){if(isset($this->request->post['nickpapoutsis_alphabank_status'])){$data['nickpapoutsis_alphabank_status']=$this->request->post['nickpapoutsis_alphabank_status'];}else{$data['nickpapoutsis_alphabank_status']=$this->config->get('nickpapoutsis_alphabank_status');}if(isset($this->request->post['nickpapoutsis_alphabank_merchant_id'])){$data['nickpapoutsis_alphabank_merchant_id']=$this->request->post['nickpapoutsis_alphabank_merchant_id'];}else{$data['nickpapoutsis_alphabank_merchant_id']=$this->config->get('nickpapoutsis_alphabank_merchant_id');}if(isset($this->request->post['nickpapoutsis_alphabank_secret'])){$data['nickpapoutsis_alphabank_secret']=$this->request->post['nickpapoutsis_alphabank_secret'];}else{$data['nickpapoutsis_alphabank_secret']=$this->config->get('nickpapoutsis_alphabank_secret');}if(isset($this->request->post['nickpapoutsis_alphabank_geo_zone_id'])){$data['nickpapoutsis_alphabank_geo_zone_id']=$this->request->post['nickpapoutsis_alphabank_geo_zone_id'];}else{$data['nickpapoutsis_alphabank_geo_zone_id']=$this->config->get('nickpapoutsis_alphabank_geo_zone_id');}if(isset($this->request->post['nickpapoutsis_alphabank_total'])){$data['nickpapoutsis_alphabank_total']=$this->request->post['nickpapoutsis_alphabank_total'];}else{$data['nickpapoutsis_alphabank_total']=$this->config->get('nickpapoutsis_alphabank_total');}if(isset($this->request->post['nickpapoutsis_alphabank_sort_order'])){$data['nickpapoutsis_alphabank_sort_order']=$this->request->post['nickpapoutsis_alphabank_sort_order'];}else{$data['nickpapoutsis_alphabank_sort_order']=$this->config->get('nickpapoutsis_alphabank_sort_order');}}if(true){if(isset($this->request->post['nickpapoutsis_alphabank_order_status_sale_id'])){$data['nickpapoutsis_alphabank_order_status_sale_id']=$this->request->post['nickpapoutsis_alphabank_order_status_sale_id'];}else{$data['nickpapoutsis_alphabank_order_status_sale_id']=$this->config->get('nickpapoutsis_alphabank_order_status_sale_id');}if(isset($this->request->post['nickpapoutsis_alphabank_order_status_preauth_id'])){$data['nickpapoutsis_alphabank_order_status_preauth_id']=$this->request->post['nickpapoutsis_alphabank_order_status_preauth_id'];}else{$data['nickpapoutsis_alphabank_order_status_preauth_id']=$this->config->get('nickpapoutsis_alphabank_order_status_preauth_id');}}if(true){if(isset($this->request->post['nickpapoutsis_alphabank_settlement_type'])){$data['nickpapoutsis_alphabank_settlement_type']=$this->request->post['nickpapoutsis_alphabank_settlement_type'];}elseif(!isset($this->request->post['nickpapoutsis_alphabank_settlement_type'])&&$this->config->get('nickpapoutsis_alphabank_settlement_type')!=''){$data['nickpapoutsis_alphabank_settlement_type']=$this->config->get('nickpapoutsis_alphabank_settlement_type');}else{$data['nickpapoutsis_alphabank_settlement_type']=1;}if(isset($this->request->post['nickpapoutsis_alphabank_masterpass_status'])){$data['nickpapoutsis_alphabank_masterpass_status']=$this->request->post['nickpapoutsis_alphabank_masterpass_status'];}else{$data['nickpapoutsis_alphabank_masterpass_status']=$this->config->get('nickpapoutsis_alphabank_masterpass_status');}if(isset($this->request->post['nickpapoutsis_alphabank_order_description'])){$data['nickpapoutsis_alphabank_order_description']=$this->request->post['nickpapoutsis_alphabank_order_description'];}else{$data['nickpapoutsis_alphabank_order_description']=$this->config->get('nickpapoutsis_alphabank_order_description');}if(isset($this->request->post['nickpapoutsis_alphabank_installments'])){$data['nickpapoutsis_alphabank_installments']=$this->request->post['nickpapoutsis_alphabank_installments'];}else{$data['nickpapoutsis_alphabank_installments']=$this->config->get('nickpapoutsis_alphabank_installments');}if(isset($this->request->post['nickpapoutsis_alphabank_environment'])){$data['nickpapoutsis_alphabank_environment']=$this->request->post['nickpapoutsis_alphabank_environment'];}else{$data['nickpapoutsis_alphabank_environment']=$this->config->get('nickpapoutsis_alphabank_environment');}}if(true){if(isset($this->request->post['nickpapoutsis_alphabank_css_url'])){$data['nickpapoutsis_alphabank_css_url']=$this->request->post['nickpapoutsis_alphabank_css_url'];}else{$data['nickpapoutsis_alphabank_css_url']=$this->config->get('nickpapoutsis_alphabank_css_url');}if(isset($this->request->post['nickpapoutsis_alphabank_test_url'])){$data['nickpapoutsis_alphabank_test_url']=$this->request->post['nickpapoutsis_alphabank_test_url'];}else{$data['nickpapoutsis_alphabank_test_url']=$this->config->get('nickpapoutsis_alphabank_test_url');}if(isset($this->request->post['nickpapoutsis_alphabank_live_url'])){$data['nickpapoutsis_alphabank_live_url']=$this->request->post['nickpapoutsis_alphabank_live_url'];}else{$data['nickpapoutsis_alphabank_live_url']=$this->config->get('nickpapoutsis_alphabank_live_url');}}if(true){if(isset($this->request->post['nickpapoutsis_alphabank_debug'])){$data['nickpapoutsis_alphabank_debug']=$this->request->post['nickpapoutsis_alphabank_debug'];}else{$data['nickpapoutsis_alphabank_debug']=$this->config->get('nickpapoutsis_alphabank_debug');}}if(true){if(isset($this->request->post['nickpapoutsis_alphabank_registration_email'])){$data['nickpapoutsis_alphabank_registration_email']=$this->request->post['nickpapoutsis_alphabank_registration_email'];}else{$data['nickpapoutsis_alphabank_registration_email']=$this->config->get('nickpapoutsis_alphabank_registration_email');}if(isset($this->request->post['nickpapoutsis_alphabank_status_enabled'])){$data['nickpapoutsis_alphabank_status_enabled']=$this->request->post['nickpapoutsis_alphabank_status_enabled'];}else{$data['nickpapoutsis_alphabank_status_enabled']=$this->config->get('nickpapoutsis_alphabank_status_enabled');}}$data['header']=$this->load->controller('common/header');$data['column_left']=$this->load->controller('common/column_left');$data['footer']=$this->load->controller('common/footer');$data['store_name']=$this->config->get('config_name');$data['config_email']=$this->config->get('config_email');$data['store_url']=$_SERVER['SERVER_NAME'];$data['script_filename']=$_SERVER['SCRIPT_FILENAME'];$data['current_time']=(date("D j M Y G:i:s T"));$data['server_info']="<pre>".print_r($_SERVER,true)."</pre>";$this->response->setOutput($this->load->view('extension/payment/nickpapoutsis_alphabank.tpl',$data));}protected function validate(){if(!$this->user->hasPermission('modify','extension/payment/nickpapoutsis_alphabank')){$this->error['warning']=$this->language->get('error_permission');}return!$this->error;}public function langStrings($lang){$data=array();if($lang=='en'){$data['entry_text_yes']='Yes';$data['entry_text_no']='No';$data['entry_text_save']='Save';$data['entry_support_save']='Save';$data['entry_text_add']='Add';$data['entry_text_update']='Update';$data['entry_text_cancel']='Cancel';$data['button_save']='Save';$data['button_cancel']='Cancel';$data['text_all_zones']='All zones';$data['entry_login_heading']='<b style="color:#555">Alphabank Payment Gateway</b> <b style="color:#00b6ec">(3DSecure enabled)</b>';$data['entry_login_form_name']='<div style="font-size: 1.5em;">Register</div>';$data['entry_login_form_name_subtitle']='to activate the extension';$data['entry_login_order_no']='Order ID';$data['entry_login_order_no_info']='It can be found in the e-mail Opencart sent you <br>or<br> in your Opencart Account page.';$data['entry_login_store_url']='Website URL';$data['entry_login_store_email']='e-mail';$data['entry_login_textbox_placeholder']='Order Number';$data['heading_title']='<b style="color:#555">Alphabank Payment Gateway</b> <b style="color:#00b6ec">(3DSecure enabled)</b>';$data['heading_title_plain']='Alphabank Payment Gateway (3DSecure enabled)';$data['text_extension']='Extensions';$data['text_success']='Success: You have modified Alphabank Payment Gateway account details!';$data['text_notification_url']='Notification URL';$data['text_live']='Live';$data['text_demo']='Test';$data['text_enabled']='Enabled';$data['text_disabled']='Disabled';$data['text_merchant_id']='Store ID';$data['text_secret']='Shared secret';$data['text_settle_auto']='Sale';$data['text_settle_delayed']='Pre-Authorize';$data['entry_merchant_id']='Merchant ID';$data['entry_secret']='Shared secret';$data['entry_total']='Total';$data['entry_sort_order']='Sort order';$data['entry_geo_zone']='Geo zone';$data['entry_status']='Status';$data['entry_debug']='Debug logging';$data['entry_live_demo']='Environment';$data['entry_auto_settle']='Settlement type';$data['entry_card_select']='Select card';$data['entry_tss_check']='TSS checks';$data['entry_live_url']='Live URL';$data['entry_test_url']='Test URL';$data['entry_css_url']='CSS URL';$data['entry_status_success_settled']='Success - (Sale)';$data['entry_status_success_unsettled']='Success - (Pre-Authorize)';$data['masterpass_status']='Masterpass Status';$data['help_total']='The checkout total the order must reach before this payment method becomes active';$data['help_notification']='You need to supply this URL to First Data to get payment notifications';$data['help_debug']='Enabling debug will write sensitive data to a log file. You should always disable unless instructed otherwise';$data['help_settle']='If you use pre-auth you must complete a post-auth action within 3-5 days otherwise your transaction will be dropped';$data['tab_account']='General';$data['tab_order_status']='Order status';$data['tab_payment']='Payment settings';$data['tab_urls']='URLs';$data['tab_advanced']='Advanced';$data['error_merchant_id']='Store ID is required';$data['error_secret']='Shared secret is required';$data['error_live_url']='Live URL is required';$data['error_demo_url']='Demo URL is required';$data['error_data_missing']='Data missing';$data['error_void_error']='Unable to void transaction';$data['error_capture_error']='Unable to capture transaction';$data['entry_tab_general']='General';$data['entry_tab_system']='System';$data['entry_tab_support']='Support';$data['entry_support_heading']='<b style="color:#555">Alphabank Payment Gateway</b> <b style="color:#00b6ec">(3DSecure enabled)</b>';$data['entry_support_support_title']='FREE Support';$data['entry_support_support_body']='With the purchase of this extension you are entitled to <strong>12 months of FREE support</strong>. <br> In case of a bug, incompatibility, or if you want a new feature added, just contact me by e-mail.';$data['entry_support_contact_title']='Contact';$data['entry_support_contact_body_1']='<a href="mailto:nikospapoutsis@gmail.com?subject=Alphabank Payment Gateway Support - ';$data['entry_support_contact_body_2']='" target="_blank">nikospapoutsis@gmail.com</a>';$data['entry_support_credits_title']='Credits';$data['entry_support_credits_body']='Copyright 	&copy; '.date("Y").' - Nick Papoutsis - All Rights Reserved.';$data['entry_support_links_title']='Links';$data['entry_support_links_body_1']='If you like this extension, please consider giving it a 5-star rating <span style="position:relative;top:3px;width:80px;height:17px;display:inline-block;background:url(data:data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAARCAYAAADUryzEAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABZ0RVh0Q3JlYXRpb24gVGltZQAwNy8wNy8xMrG4sToAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzbovLKMAAACr0lEQVQ4jX1US0+TURA98/Xri0KBYqG8BDYItBoIBhFBBdRNTTQx0Q0gujBiAkEXxoXxD6iJbRcaY1iQEDXqTgwQWkWDIBU3VqWQoEgECzUU+n5910VbHhacZHLvzD05c+fMzaVhgxYJIwIYi+8B8FJ5bzjob9ucB4DmLttGMGyoAGMsyc1G7bEvA91roz2NL7Y7TziHHSxFmWsorbuUFgn79BaTLnMn3LYEZqPukCKruFAUGEd54w1ekqK69x8CSkoqMnJv72noTmN+O9Q5KlE44GqxmHTS7Qho5MH+X8SJUuMhAIbM/CrS1tSnCYsmkOoUnO7SiP3dHV8Mw5AoKkRCfTwR96ei+ZZGVVDDJQhIWAVbfhjDe8eQnd/Aq8+/VAIsAcGbR8ejQiR8jcwGbYZEkTFVd7I9B4IXcL+GEPwdK4SN0XJSDaCoAvHZsA4/93hWHNVNnbZpjoG5gl7XvpFnxggxAZRaA0rokliIAIkaxMnwdWLE7XW77jd12qYBgCMiNHfZlhgTCkZfPfUDBAYGItoiL0lK8N0+51txzD1u7Ji8njTGpk6bg/iUhSiU4GT5YOtPL940AOfiDyHod9/dMsYEzmLS5bBoKE/ES8ECCyACSF4IFledAdhd2SIFUdtmAp7i92QM+uKqVg6RJXDKakCcjyjSwcldMUDgG7I0h8WKdI0ewM2kFuTpmlb1bp2UMYBJyjBjm/FYh57MjA/1+1wuESNZOfjoLPwe516zUSdLIgi6l+sl3CIW5leD7/v7HPNTE+cOtr8tDXhWy+zWAcvnDx/XoiEPiirPBomgXxd32KAFEWp3FR0YdP60pop4sfHI5cmr+MfMRl2tXKnqzS5pyFuaHRusu2A5EyeoAEAQS2Q94VDg4pY/YUOf9ZgxnBaJJSeOdny6AgB/AYEpKtpaTusRAAAAAElFTkSuQmCC)"></span> on the extensions page :)<br><br><b>Extension page :</b> <a target="_blank" href="https://';$data['entry_support_links_body_2']='opencart.com/index.php?route=marketplace/extension/info&extension_id=40313">Alphabank Payment Gateway</a><br><b>Other extensions :</b> <a target="_blank" href="https://';$data['entry_support_links_body_3']='opencart.com/index.php?route=marketplace/extension&filter_member=nickpapoutsis">My other Opencart extensions</a><br>';$data['entry_support_license_name']='License';$data['entry_support_license_expand']='Expand';$data['entry_support_license_text']='Single Use / Single Domain License (SUSDL)';$data['entry_support_license_more_text']='
            All parts of this extension (SOFTWARE) including, but not limited to algorithms, code, texts, images and designs are licensed according to this license, unless otherwise stated.
            <br>
            The SUSDL grants you a non-exclusive and non-transferable right to use this SOFTWARE subject to the following conditions:
            <br>
            – You have been granted this license explicitly by the copyright holder.
            <br>
            – You are granted use of the SOFTWARE on one single domain or sub-domain.
            <br>
            – You may use the SOFTWARE for your own purposes or for a client, anyhow, use of the SOFTWARE is limited to one domain or sub-domain only.
            <br>
            – Use on multiple domains, including sub-domains, requires you to purchase the extension for each domain or sub-domain you wish to use the SOFTWARE on.
            <br>
            – You must not directly or indirectly license, sub-license, rent, lend, sell,resell, provide for free, reproduce or distribute by any means the SOFTWARE.
            <br>
            The same applies to derivative works based on the SOFTWARE.
            <br>
            The same applies to works based on reverse-engineered versions of this SOFTWARE.
            <br>
            Derivative works based on the SOFTWARE includes descriptions of the algorithms and methods implemented.
            <br>
            – You must not create derivative works based on the SOFTWARE.
            <br>
            – You must not reverse-engineer the SOFTWARE.
            <br>
            – You must not incorporate the SOFTWARE in any work created for resale.
            <br>
            – You must not use the SOFTWARE to provide services similar to those provided by the SOFTWARE.
            <br>
            All parts of the SOFTWARE are distributed in the hope that they will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.';$data['error_permission']='Warning: You do not have permission to modify this extension!';}return $data;}}
